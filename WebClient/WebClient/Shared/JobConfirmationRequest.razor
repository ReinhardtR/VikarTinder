@using HttpClients
@using HttpClients.Services
@inject JobConfirmationService JobConfirmationService

<MudStack Justify="Justify.Center" AlignItems="AlignItems.Center">
    <MudText>Vil du have jobbet?</MudText>
    
    <MudStack Row="@true" Justify="Justify.Center" AlignItems="AlignItems.Center">
        <MudButton OnClick="() => AnswerHandler(true)" Variant="Variant.Filled" Color="Color.Success" Disabled="@isEmployer">
            Ja
        </MudButton>
        <MudButton OnClick="() => AnswerHandler(false)" Variant="Variant.Outlined" Color="Color.Error" Disabled="@isEmployer">
            Nej
        </MudButton>
        @if (isEmployer)
        {
            <MudButton OnClick="CancelHandler" Variant="Variant.Text" Disabled="@(!isEmployer)">
                Annuller
            </MudButton>
        }
    </MudStack>
    
    @if (errorLabel != null)
    {
        <MudText Typo="Typo.caption" Color="Color.Error">@errorLabel</MudText>
    }
</MudStack>

@code {

    [Parameter]
    public JobConfirmationDTO JobConfirmation { get; set; }
    
    // TODO replace with auth stuff
    private int userId = 2;

    // TODO replace with auth stuff
    private bool isEmployer = false;

    private string? errorLabel;
  
    
    private async void AnswerHandler(bool isAccepted)
    {
        try
        {
            errorLabel = null;
            
            JobConfirmationAnswer jobConfirmationAnswer = new()
            {
                Id = JobConfirmation.Id,
                ChatId = JobConfirmation.ChatId,
                IsAccepted = isAccepted,
            };
            
            await JobConfirmationService.AnswerJobConfirmationAsync(jobConfirmationAnswer);
        } 
        catch (Exception e)
        {
            errorLabel = "Failed to send answer";
        }
    }

    private void CancelHandler()
    {
        try
        {
    // call server and cancel job request
        }
        catch (Exception e)
        {
    // error handling
        }
    }
}